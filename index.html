<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Accurate MP3 Player</title>
</head>
<body>
    <h1>Accurate MP3 Playback</h1>
    <label for="rate">Times per second:</label>
    <input type="number" id="rate" min="1" step="1" value="30">
    <br><br>
    <button id="startBtn">Start</button>
    <button id="stopBtn">Stop</button>

    <script>
        let audioContext;
        let buffer;
        let playing = false;
        let nextTime = 0; // Next scheduled time

        async function loadAudio() {
            audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const response = await fetch('SFX.mp3');
            const arrayBuffer = await response.arrayBuffer();
            buffer = await audioContext.decodeAudioData(arrayBuffer);
        }

        function playSound(time) {
            const source = audioContext.createBufferSource();
            source.buffer = buffer;
            source.connect(audioContext.destination);
            source.start(time);
        }

        function scheduler(rate) {
            const interval = 1 / rate;
            while (nextTime < audioContext.currentTime + 0.1) { 
                playSound(nextTime);
                nextTime += interval;
            }
            if (playing) {
                requestAnimationFrame(() => scheduler(rate));
            }
        }

        document.getElementById('startBtn').addEventListener('click', async () => {
            if (!buffer) await loadAudio();
            if (!playing) {
                playing = true;
                nextTime = audioContext.currentTime;
                const rate = parseFloat(document.getElementById('rate').value);
                scheduler(rate);
            }
        });

        document.getElementById('stopBtn').addEventListener('click', () => {
            playing = false;
        });
    </script>
</body>
</html>
